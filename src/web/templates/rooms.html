{% extends "base.html" %}

{% block title %}RÃ¤ume & Zonen - KI Smart Home{% endblock %}

{% block content %}
<div class="rooms-page">
    <h2>RÃ¤ume & Zonen</h2>

    <!-- Sync mit Homey -->
    <div class="card">
        <div class="sync-header">
            <div>
                <h3>Homey Zonen synchronisieren</h3>
                <p>Importieren Sie Ihre RÃ¤ume/Zonen direkt aus Homey Pro</p>
            </div>
            <div class="sync-buttons">
                <button class="btn btn-primary" id="sync-zones">
                    ğŸ”„ Zonen aktualisieren
                </button>
                <button class="btn btn-primary" id="sync-device-assignments">
                    ğŸ“± GerÃ¤te-Zuordnungen importieren
                </button>
            </div>
        </div>
        <div id="sync-status" class="sync-status"></div>
    </div>

    <!-- RÃ¤ume-Ãœbersicht -->
    <div class="card">
        <h3>Ihre RÃ¤ume</h3>
        <div id="rooms-grid" class="rooms-grid">
            <div class="loading">Lade RÃ¤ume...</div>
        </div>
    </div>

    <!-- Raum hinzufÃ¼gen -->
    <div class="card">
        <h3>Neuen Raum hinzufÃ¼gen</h3>
        <form id="add-room-form" class="room-form">
            <div class="form-row">
                <div class="form-group">
                    <label>Raum-Name:</label>
                    <input type="text" id="new-room-name" placeholder="z.B. Wohnzimmer" required>
                </div>
                <div class="form-group">
                    <label>Icon:</label>
                    <select id="new-room-icon">
                        <option value="ğŸ ">ğŸ  Wohnzimmer</option>
                        <option value="ğŸ›ï¸">ğŸ›ï¸ Schlafzimmer</option>
                        <option value="ğŸ³">ğŸ³ KÃ¼che</option>
                        <option value="ğŸš¿">ğŸš¿ Badezimmer</option>
                        <option value="ğŸšª">ğŸšª Flur</option>
                        <option value="ğŸ¢">ğŸ¢ BÃ¼ro</option>
                        <option value="ğŸ®">ğŸ® Gaming-Zimmer</option>
                        <option value="ğŸŒ³">ğŸŒ³ Garten</option>
                        <option value="ğŸš—">ğŸš— Garage</option>
                        <option value="ğŸ“¦">ğŸ“¦ Keller</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Raum hinzufÃ¼gen</button>
            </div>
        </form>
    </div>

    <!-- GerÃ¤te-Zuordnung -->
    <div class="card">
        <h3>GerÃ¤te zu RÃ¤umen zuordnen</h3>
        <p>WÃ¤hlen Sie einen Raum aus, um GerÃ¤te zuzuordnen:</p>

        <div class="room-selector">
            <select id="room-select" class="room-select">
                <option value="">Raum wÃ¤hlen...</option>
            </select>
            <span id="device-count-badge" class="badge"></span>
        </div>

        <div id="room-devices-container" class="room-devices-container hidden">
            <h4>GerÃ¤te in <span id="selected-room-name"></span>:</h4>

            <!-- Aktuell zugeordnete GerÃ¤te -->
            <div class="assigned-devices">
                <h5>Zugeordnete GerÃ¤te:</h5>
                <div id="assigned-devices-list" class="devices-list"></div>
            </div>

            <!-- VerfÃ¼gbare GerÃ¤te -->
            <div class="available-devices">
                <h5>VerfÃ¼gbare GerÃ¤te hinzufÃ¼gen:</h5>
                <input type="text" id="device-search" placeholder="GerÃ¤t suchen..." class="search-input">
                <div id="available-devices-list" class="devices-list"></div>
            </div>
        </div>
    </div>

    <!-- Fenster & TÃ¼ren Zuordnung -->
    <div class="card">
        <h3>ğŸªŸ Fenster & TÃ¼ren den RÃ¤umen zuordnen</h3>
        <p>Ordnen Sie Ihre Fenster- und TÃ¼r-Sensoren den richtigen RÃ¤umen zu fÃ¼r die LÃ¼ftungsstatistik:</p>

        <div id="window-assignment-loading" class="loading" style="display: none;">
            Lade Sensoren...
        </div>

        <div id="window-assignment-container">
            <!-- Wird dynamisch gefÃ¼llt -->
        </div>

        <div id="window-assignment-empty" class="info-box" style="display: none;">
            <strong>â„¹ï¸ Hinweis:</strong> Keine Fenster- oder TÃ¼r-Sensoren gefunden.
            <br>Synchronisieren Sie erst Ihre GerÃ¤te mit Homey.
        </div>
    </div>

    <!-- Raumbasierte Automatisierungen -->
    <div class="card">
        <h3>Raumbasierte Automatisierungen</h3>
        <p>Erstellen Sie Regeln fÃ¼r einzelne RÃ¤ume:</p>

        <div id="room-automations" class="room-automations">
            <!-- Wird dynamisch gefÃ¼llt -->
        </div>

        <button class="btn btn-secondary" id="add-room-automation">
            â• Neue Raum-Regel hinzufÃ¼gen
        </button>
    </div>
</div>

<!-- Raum-Details Modal -->
<div id="room-modal" class="modal">
    <div class="modal-content modal-large">
        <span class="close">&times;</span>
        <h3 id="modal-room-title">Raum Details</h3>

        <div class="room-details">
            <div class="room-info">
                <div class="room-icon-large" id="modal-room-icon">ğŸ </div>
                <div>
                    <p><strong>Raum-ID:</strong> <span id="modal-room-id"></span></p>
                    <p><strong>GerÃ¤te:</strong> <span id="modal-room-device-count"></span></p>
                </div>
            </div>

            <div class="room-stats">
                <h4>Statistiken</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="room-lights-count">0</div>
                        <div class="stat-label">ğŸ’¡ Lichter</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="room-sensors-count">0</div>
                        <div class="stat-label">ğŸ“Š Sensoren</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="room-switches-count">0</div>
                        <div class="stat-label">ğŸ”Œ Schalter</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="room-climate-count">0</div>
                        <div class="stat-label">ğŸŒ¡ï¸ Klima</div>
                    </div>
                </div>
            </div>

            <div class="room-actions">
                <button class="btn btn-primary" id="room-all-lights-on">Alle Lichter AN</button>
                <button class="btn btn-secondary" id="room-all-lights-off">Alle Lichter AUS</button>
                <button class="btn btn-warning" id="edit-room">âœï¸ Raum bearbeiten</button>
                <button class="btn btn-danger" id="delete-room">Raum lÃ¶schen</button>
            </div>

            <!-- Edit Form (hidden by default) -->
            <div id="edit-room-form" class="edit-room-form" style="display: none;">
                <h4>Raum bearbeiten</h4>
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="edit-room-name" class="form-control">
                </div>
                <div class="form-group">
                    <label>Icon:</label>
                    <select id="edit-room-icon" class="form-control">
                        <option value="ğŸ ">ğŸ  Standard</option>
                        <option value="ğŸ›‹ï¸">ğŸ›‹ï¸ Wohnzimmer</option>
                        <option value="ğŸ›ï¸">ğŸ›ï¸ Schlafzimmer</option>
                        <option value="ğŸ³">ğŸ³ KÃ¼che</option>
                        <option value="ğŸš¿">ğŸš¿ Badezimmer</option>
                        <option value="ğŸšª">ğŸšª Flur</option>
                        <option value="ğŸ’¼">ğŸ’¼ BÃ¼ro</option>
                        <option value="ğŸ®">ğŸ® Gaming-Zimmer</option>
                        <option value="ğŸŒ³">ğŸŒ³ Garten</option>
                        <option value="ğŸš—">ğŸš— Garage</option>
                        <option value="ğŸ“¦">ğŸ“¦ Keller</option>
                        <option value="ğŸ’¡">ğŸ’¡ Lichtbereich</option>
                        <option value="ğŸ¡">ğŸ¡ Terrasse</option>
                        <option value="ğŸ§º">ğŸ§º WaschkÃ¼che</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" id="save-room-edit">ğŸ’¾ Speichern</button>
                    <button class="btn btn-secondary" id="cancel-room-edit">Abbrechen</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/rooms.js') }}"></script>
{% endblock %}
