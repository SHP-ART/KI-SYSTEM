{% extends "base.html" %}

{% block title %}Einstellungen - KI Smart Home{% endblock %}

{% block content %}
<div class="settings-page">
    <h2>Einstellungen</h2>

    <div class="settings-sections">
        <!-- Platform Settings -->
        <div class="card settings-card">
            <h3>Smart Home Platform</h3>
            <form class="settings-form">
                <div class="form-group">
                    <label for="platform-type">Platform Typ:</label>
                    <select id="platform-type" disabled>
                        <option value="homeassistant">Home Assistant</option>
                        <option value="homey">Homey Pro</option>
                    </select>
                    <small>Platform-Typ kann nur in config.yaml ge√§ndert werden</small>
                </div>
            </form>
        </div>

        <!-- Sensor Configuration -->
        <div class="card settings-card">
            <h3>üå°Ô∏è Indoor-Sensor Konfiguration</h3>
            <p class="card-description">
                W√§hle welche Sensoren f√ºr die Indoor-Temperatur und Luftfeuchtigkeit verwendet werden sollen.
                <strong>Standard:</strong> Alle Sensoren werden automatisch verwendet.
            </p>

            <div class="form-group">
                <h4>Temperatur-Sensoren</h4>
                <p class="small-text">Durchschnitt aller ausgew√§hlten Sensoren wird als Indoor-Temperatur verwendet</p>
                <div id="temp-sensors-list" class="sensors-list">
                    <div class="loading">Lade Sensoren...</div>
                </div>
                <button class="btn btn-small btn-secondary" id="select-all-temp">Alle ausw√§hlen</button>
                <button class="btn btn-small btn-secondary" id="deselect-all-temp">Alle abw√§hlen</button>
            </div>

            <div class="form-group">
                <h4>Luftfeuchtigkeit-Sensoren</h4>
                <div id="humidity-sensors-list" class="sensors-list">
                    <div class="loading">Lade Sensoren...</div>
                </div>
                <button class="btn btn-small btn-secondary" id="select-all-humidity">Alle ausw√§hlen</button>
                <button class="btn btn-small btn-secondary" id="deselect-all-humidity">Alle abw√§hlen</button>
            </div>

            <button class="btn btn-primary" id="save-sensor-config">Sensor-Konfiguration speichern</button>
            <div id="sensor-save-result" class="action-result"></div>
        </div>

        <!-- Data Collection Settings -->
        <div class="card settings-card">
            <h3>Datensammlung</h3>
            <form class="settings-form">
                <div class="form-group">
                    <label for="collection-interval">Sammel-Intervall (Sekunden):</label>
                    <input type="number" id="collection-interval" min="60" max="3600" step="60" value="300">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enable-weather" checked>
                        Wetter-Integration aktivieren
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enable-energy-prices">
                        Energie-Preise Integration
                    </label>
                </div>
            </form>
        </div>

        <!-- Decision Engine Settings -->
        <div class="card settings-card">
            <h3>Entscheidungs-Engine</h3>
            <form class="settings-form">
                <div class="form-group">
                    <label for="decision-mode">Modus:</label>
                    <select id="decision-mode">
                        <option value="auto">Automatisch</option>
                        <option value="learning">Nur Lernen</option>
                        <option value="manual">Manuell</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="confidence-threshold">Konfidenz-Schwellwert:</label>
                    <input type="range" id="confidence-threshold" min="0" max="1" step="0.05" value="0.7">
                    <span id="confidence-value">0.7</span>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="safety-checks" checked disabled>
                        Sicherheitschecks aktiviert
                    </label>
                    <small>Kann nicht deaktiviert werden</small>
                </div>
            </form>
        </div>

        <!-- System Info -->
        <div class="card settings-card">
            <h3>System-Information</h3>
            <div class="system-info">
                <div class="info-row">
                    <span class="label">Datenbank:</span>
                    <span id="db-path">data/ki_system.db</span>
                </div>
                <div class="info-row">
                    <span class="label">Log-Level:</span>
                    <span id="log-level">INFO</span>
                </div>
                <div class="info-row">
                    <span class="label">Trainierte Modelle:</span>
                    <span id="trained-models">0</span>
                </div>
                <div class="info-row">
                    <span class="label">Gespeicherte Datenpunkte:</span>
                    <span id="data-points">--</span>
                </div>
            </div>
        </div>

        <!-- ML Training & KI-Status -->
        <div class="card settings-card">
            <h3>ü§ñ ML Training & KI-Status</h3>
            <p class="card-description">
                Das System trainiert automatisch Machine Learning Modelle,  sobald genug Daten gesammelt wurden.
            </p>

            <div class="ml-status-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                <!-- Lighting Model Status -->
                <div class="ml-model-status" style="background: #f9fafb; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">LIGHTING MODEL</div>
                    <div id="lighting-model-status" style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">
                        <span class="status-dot" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #fbbf24; margin-right: 6px;"></span>
                        Warte auf Daten
                    </div>
                    <div style="font-size: 13px; color: #6b7280;">
                        <div id="lighting-data-count">0 / 100 Events</div>
                        <div id="lighting-last-trained" style="margin-top: 4px;">Nie trainiert</div>
                    </div>
                </div>

                <!-- Temperature Model Status -->
                <div class="ml-model-status" style="background: #f9fafb; padding: 15px; border-radius: 8px; border-left: 4px solid #ec4899;">
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">TEMPERATURE MODEL</div>
                    <div id="temp-model-status" style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">
                        <span class="status-dot" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #fbbf24; margin-right: 6px;"></span>
                        Warte auf Daten
                    </div>
                    <div style="font-size: 13px; color: #6b7280;">
                        <div id="temp-data-count">0 / 200 Readings</div>
                        <div id="temp-last-trained" style="margin-top: 4px;">Nie trainiert</div>
                    </div>
                </div>

                <!-- Auto-Trainer Status -->
                <div class="ml-model-status" style="background: #f9fafb; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">AUTO-TRAINER</div>
                    <div id="autotrainer-status" style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">
                        <span class="status-dot" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #10b981; margin-right: 6px;"></span>
                        Aktiv
                    </div>
                    <div style="font-size: 13px; color: #6b7280;">
                        <div>L√§uft t√§glich um 2:00 Uhr</div>
                        <div id="autotrainer-next-run" style="margin-top: 4px;">N√§chster Run: Morgen</div>
                    </div>
                </div>
            </div>

            <!-- Training Settings -->
            <div class="form-group" style="margin-top: 20px;">
                <h4 style="font-size: 14px; margin-bottom: 10px;">‚öôÔ∏è Auto-Trainer Einstellungen</h4>
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="autotrainer-enabled" checked>
                        <span>Automatisches Training aktivieren</span>
                    </label>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label for="training-hour">Trainingszeit:</label>
                        <input type="number" id="training-hour" min="0" max="23" value="2" style="width: 60px; padding: 5px;">
                        <span>:00 Uhr</span>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="action-buttons" style="margin-top: 15px;">
                <button class="btn btn-primary" id="manual-train">Jetzt manuell trainieren</button>
                <button class="btn btn-secondary" id="refresh-ml-status">Status aktualisieren</button>
                <button class="btn btn-secondary" id="save-ml-settings" style="display: none;">Einstellungen speichern</button>
            </div>
            <div id="ml-training-result" class="action-result"></div>

            <!-- Training History -->
            <details style="margin-top: 20px;">
                <summary style="cursor: pointer; font-weight: 600; padding: 10px; background: #f9fafb; border-radius: 6px;">
                    üìä Trainingshistorie anzeigen
                </summary>
                <div id="training-history" style="margin-top: 10px; font-size: 13px;">
                    <div class="loading">Lade Verlauf...</div>
                </div>
            </details>
        </div>

        <!-- System Updates -->
        <div class="card settings-card">
            <h3>System-Updates</h3>
            <div class="system-info">
                <div class="info-row">
                    <span class="label">Aktuelle Version:</span>
                    <span id="current-version">Lade...</span>
                </div>
                <div class="info-row">
                    <span class="label">Commit:</span>
                    <span id="current-commit">--</span>
                </div>
                <div class="info-row">
                    <span class="label">Update verf√ºgbar:</span>
                    <span id="update-status">Pr√ºfe...</span>
                </div>
                <div id="new-commits-list" style="display: none; margin-top: 1rem;">
                    <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem;">Neue Updates:</h4>
                    <ul id="commits-list" style="font-size: 0.85rem; margin-left: 1.5rem;"></ul>
                </div>
            </div>
            <div class="action-buttons" style="margin-top: 1rem;">
                <button class="btn btn-secondary" id="check-update">Nach Updates suchen</button>
                <button class="btn btn-primary" id="install-update" style="display: none;">Update installieren</button>
            </div>
            <div id="update-result" class="action-result"></div>
        </div>

        <!-- Actions -->
        <div class="card settings-card">
            <h3>Aktionen</h3>
            <div class="action-buttons">
                <button class="btn btn-primary" id="test-connection">Verbindung testen</button>
                <button class="btn btn-secondary" id="retrain-models">Modelle neu trainieren</button>
                <button class="btn btn-danger" id="clear-data">Daten l√∂schen</button>
            </div>
            <div id="action-result" class="action-result"></div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}
