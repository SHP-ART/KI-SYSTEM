{% extends "base.html" %}

{% block title %}Badezimmer Automatisierung - KI Smart Home{% endblock %}

{% block content %}
<div class="bathroom-automation">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div>
            <h2>ğŸš¿ Badezimmer Automatisierung</h2>
            <p class="subtitle">Intelligente Steuerung von Luftentfeuchter und Heizung</p>
        </div>
        <a href="/luftentfeuchten/analytics" class="btn btn-primary" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            ğŸ“Š Analytics & Lernsystem
        </a>
    </div>

    <!-- Status Card -->
    <div class="card status-card">
        <h3>Aktueller Status</h3>
        <div class="status-grid">
            <div class="status-item">
                <span class="status-icon" id="shower-status-icon">â¸ï¸</span>
                <div>
                    <div class="status-label">Dusche erkannt</div>
                    <div class="status-value" id="shower-status">Nein</div>
                </div>
            </div>
            <div class="status-item">
                <span class="status-icon" id="dehumidifier-status-icon">â¸ï¸</span>
                <div>
                    <div class="status-label">Luftentfeuchter</div>
                    <div class="status-value" id="dehumidifier-status">Aus</div>
                </div>
            </div>
            <div class="status-item">
                <span class="status-icon">ğŸ’§</span>
                <div>
                    <div class="status-label">Luftfeuchtigkeit</div>
                    <div class="status-value" id="current-humidity">--%</div>
                </div>
            </div>
            <div class="status-item">
                <span class="status-icon">ğŸŒ¡ï¸</span>
                <div>
                    <div class="status-label">Temperatur</div>
                    <div class="status-value" id="current-temperature">--Â°C</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Sensor Values & Actuator Testing -->
    <div class="card" id="live-sensors-card" style="display: none;">
        <h3>ğŸ“¡ Live-Sensor-Werte & Aktoren-Test</h3>
        <p class="subtitle" style="margin-bottom: 20px;">Echtzeitwerte der konfigurierten Sensoren und Steuerung der Aktoren</p>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <!-- Humidity Sensor -->
            <div class="sensor-live-card" id="live-humidity-card" style="display: none;">
                <div class="sensor-header">
                    <span class="sensor-icon">ğŸ’§</span>
                    <span class="sensor-name" id="live-humidity-name">Luftfeuchtigkeit</span>
                </div>
                <div class="sensor-value" id="live-humidity-value">--%</div>
                <div class="sensor-meta" id="live-humidity-meta">Warte auf Daten...</div>
            </div>

            <!-- Temperature Sensor -->
            <div class="sensor-live-card" id="live-temp-card" style="display: none;">
                <div class="sensor-header">
                    <span class="sensor-icon">ğŸŒ¡ï¸</span>
                    <span class="sensor-name" id="live-temp-name">Temperatur</span>
                </div>
                <div class="sensor-value" id="live-temp-value">--Â°C</div>
                <div class="sensor-meta" id="live-temp-meta">Warte auf Daten...</div>
            </div>

            <!-- Door Sensor -->
            <div class="sensor-live-card" id="live-door-card" style="display: none;">
                <div class="sensor-header">
                    <span class="sensor-icon" id="live-door-icon">ğŸšª</span>
                    <span class="sensor-name" id="live-door-name">TÃ¼r-Sensor</span>
                </div>
                <div class="sensor-value" id="live-door-value">Unbekannt</div>
                <div class="sensor-meta" id="live-door-meta">Warte auf Daten...</div>
            </div>

            <!-- Motion Sensor -->
            <div class="sensor-live-card" id="live-motion-card" style="display: none;">
                <div class="sensor-header">
                    <span class="sensor-icon" id="live-motion-icon">ğŸ‘¤</span>
                    <span class="sensor-name" id="live-motion-name">Bewegung</span>
                </div>
                <div class="sensor-value" id="live-motion-value">Keine Bewegung</div>
                <div class="sensor-meta" id="live-motion-meta">Warte auf Daten...</div>
            </div>

            <!-- Dehumidifier Control -->
            <div class="sensor-live-card actuator-card" id="live-dehumidifier-card" style="display: none;">
                <div class="sensor-header">
                    <span class="sensor-icon" id="live-dehumidifier-icon">ğŸ’¨</span>
                    <span class="sensor-name" id="live-dehumidifier-name">Luftentfeuchter</span>
                </div>
                <div class="sensor-value" id="live-dehumidifier-value">Aus</div>
                <div style="margin-top: 15px;">
                    <button class="btn btn-sm btn-test" id="test-dehumidifier-on">â–¶ï¸ Ein</button>
                    <button class="btn btn-sm btn-test" id="test-dehumidifier-off" style="margin-left: 8px;">â¸ï¸ Aus</button>
                </div>
                <div class="sensor-meta" id="live-dehumidifier-meta">Warte auf Daten...</div>
            </div>

            <!-- Heater Control -->
            <div class="sensor-live-card actuator-card" id="live-heater-card" style="display: none;">
                <div class="sensor-header">
                    <span class="sensor-icon" id="live-heater-icon">ğŸ”¥</span>
                    <span class="sensor-name" id="live-heater-name">Heizung</span>
                </div>
                <div class="sensor-value" id="live-heater-value">--Â°C</div>
                <div style="margin-top: 15px;">
                    <button class="btn btn-sm btn-test" id="test-heater-up">â¬†ï¸ +1Â°C</button>
                    <button class="btn btn-sm btn-test" id="test-heater-down" style="margin-left: 8px;">â¬‡ï¸ -1Â°C</button>
                </div>
                <div class="sensor-meta" id="live-heater-meta">Warte auf Daten...</div>
            </div>
        </div>

        <div style="margin-top: 20px; padding: 12px; background: #eff6ff; border-left: 4px solid #3b82f6; border-radius: 4px;">
            <small style="color: #1e40af;">
                â„¹ï¸ Aktualisiert alle 5 Sekunden. Aktoren-Tests schalten GerÃ¤te direkt - verwenden Sie diese Funktion vorsichtig!
            </small>
        </div>
    </div>

    <!-- Konfiguration -->
    <div class="card config-card">
        <h3>âš™ï¸ Konfiguration</h3>

        <!-- Aktivierungs-Toggle hervorgehoben -->
        <div class="enable-section" style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border: 2px solid #667eea; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
            <label class="toggle-label" style="display: flex; align-items: center; gap: 15px; cursor: pointer; margin: 0;">
                <input type="checkbox" id="bathroom-enabled" class="toggle-checkbox">
                <span class="toggle-switch"></span>
                <div style="flex: 1;">
                    <div style="font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 4px;">
                        Badezimmer-Automatisierung aktivieren
                    </div>
                    <div style="font-size: 13px; color: #6b7280;">
                        Aktiviert die automatische Steuerung basierend auf Luftfeuchtigkeit
                    </div>
                </div>
            </label>
        </div>

        <div class="form-section">
            <h4>GerÃ¤te zuweisen</h4>

            <div class="form-group">
                <label>Raum auswÃ¤hlen</label>
                <select id="room-filter" class="form-select">
                    <option value="">-- Alle RÃ¤ume --</option>
                </select>
                <small style="color: #6b7280; margin-top: 4px; display: block;">
                    WÃ¤hlen Sie einen Raum aus, um nur GerÃ¤te aus diesem Raum anzuzeigen
                </small>
            </div>

            <div class="form-group">
                <label>Luftfeuchtigkeit-Sensor *</label>
                <select id="humidity-sensor" class="form-select">
                    <option value="">-- Sensor auswÃ¤hlen --</option>
                </select>
            </div>

            <div class="form-group">
                <label>Temperatur-Sensor *</label>
                <select id="temperature-sensor" class="form-select">
                    <option value="">-- Sensor auswÃ¤hlen --</option>
                </select>
            </div>

            <div class="form-group">
                <label>Luftentfeuchter *</label>
                <select id="dehumidifier" class="form-select">
                    <option value="">-- GerÃ¤t auswÃ¤hlen --</option>
                </select>
            </div>

            <div class="form-group">
                <label>Heizung/Thermostat</label>
                <select id="heater" class="form-select">
                    <option value="">-- Optional --</option>
                </select>
            </div>

            <div class="form-group">
                <label>Bewegungssensor (Optional)</label>
                <select id="motion-sensor" class="form-select">
                    <option value="">-- Optional --</option>
                </select>
            </div>

            <div class="form-group">
                <label>TÃ¼r-Sensor (Optional)</label>
                <select id="door-sensor" class="form-select">
                    <option value="">-- Optional --</option>
                </select>
            </div>
        </div>

        <div class="form-section">
            <h4>Schwellwerte</h4>

            <div class="form-group">
                <label>Hohe Luftfeuchtigkeit (Luftentfeuchter EIN)</label>
                <div class="slider-group">
                    <input type="range" id="humidity-high" min="50" max="90" value="70" class="slider">
                    <span class="slider-value" id="humidity-high-value">70%</span>
                </div>
            </div>

            <div class="form-group">
                <label>Niedrige Luftfeuchtigkeit (Luftentfeuchter AUS)</label>
                <div class="slider-group">
                    <input type="range" id="humidity-low" min="40" max="80" value="60" class="slider">
                    <span class="slider-value" id="humidity-low-value">60%</span>
                </div>
            </div>

            <div class="form-group">
                <label>Ziel-Temperatur</label>
                <div class="slider-group">
                    <input type="range" id="target-temperature" min="18" max="26" value="22" step="0.5" class="slider">
                    <span class="slider-value" id="target-temperature-value">22Â°C</span>
                </div>
            </div>

            <div class="form-group">
                <label>VerzÃ¶gerung vor Ausschalten (Minuten)</label>
                <div class="slider-group">
                    <input type="range" id="dehumidifier-delay" min="0" max="30" value="5" class="slider">
                    <span class="slider-value" id="dehumidifier-delay-value">5 Min</span>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button id="save-bathroom-config" class="btn btn-primary">ğŸ’¾ Konfiguration speichern</button>
            <button id="test-bathroom" class="btn btn-secondary">ğŸ§ª Test ausfÃ¼hren</button>
        </div>
    </div>

    <!-- ErklÃ¤rung -->
    <div class="card info-card">
        <h3>â„¹ï¸ Wie funktioniert's?</h3>
        <div class="info-content">
            <div class="info-item">
                <strong>ğŸš¿ Duschen-Erkennung:</strong>
                <p>Das System erkennt automatisch, wenn geduscht wird: Luftfeuchtigkeit steigt Ã¼ber den eingestellten Schwellwert (Standard: 70%)</p>
            </div>
            <div class="info-item">
                <strong>ğŸ’¨ Luftentfeuchter-Steuerung:</strong>
                <p>Schaltet automatisch EIN wenn Luftfeuchtigkeit zu hoch ist, und AUS wenn sie wieder normal ist (Standard: 60%)</p>
            </div>
            <div class="info-item">
                <strong>â±ï¸ Intelligente VerzÃ¶gerung:</strong>
                <p>Nach der letzten Bewegung wartet das System 5 Minuten bevor der Luftentfeuchter ausgeschaltet wird</p>
            </div>
            <div class="info-item">
                <strong>ğŸŒ¡ï¸ Heizungs-Optimierung:</strong>
                <p>WÃ¤hrend der Entfeuchtung wird die Heizung um 1Â°C erhÃ¶ht, um die Trocknung zu beschleunigen</p>
            </div>
        </div>
    </div>
</div>

<style>
.sensor-live-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 2px solid #e5e7eb;
    transition: all 0.3s ease;
}

.sensor-live-card:hover {
    border-color: #3b82f6;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.actuator-card {
    border-color: #fbbf24;
    background: linear-gradient(135deg, #ffffff 0%, #fef3c715 100%);
}

.actuator-card:hover {
    border-color: #f59e0b;
}

.sensor-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.sensor-icon {
    font-size: 1.8em;
}

.sensor-name {
    font-weight: 600;
    color: #1f2937;
    font-size: 1.05em;
}

.sensor-value {
    font-size: 2em;
    font-weight: bold;
    color: #1f2937;
    margin: 10px 0;
}

.sensor-meta {
    font-size: 0.85em;
    color: #6b7280;
    margin-top: 8px;
}

.btn-sm {
    padding: 6px 12px;
    font-size: 0.85em;
}

.btn-test {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-test:hover {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0,0,0,0.15);
}

.btn-test:active {
    transform: translateY(0);
}

.btn-test:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Status indicators for door/motion */
.sensor-value.door-open {
    color: #ef4444;
}

.sensor-value.door-closed {
    color: #10b981;
}

.sensor-value.motion-detected {
    color: #f59e0b;
    animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}
</style>

<script src="{{ url_for('static', filename='js/luftentfeuchten.js') }}"></script>
{% endblock %}
